{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/apple/Desktop/GOSSIP/src/components/group-info.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { createClient } from \"@/lib/supabase/client\";\nimport { Avatar } from \"@/components/ui/avatar\";\nimport { X, UserPlus, Trash2, Shield, ShieldAlert, LogOut } from \"lucide-react\";\nimport { Profile } from \"@/lib/types\";\nimport { cn } from \"@/lib/utils\";\n\ninterface GroupInfoProps {\n    roomId: string;\n    onClose: () => void;\n    currentUserId: string;\n}\n\ninterface Participant extends Profile {\n    role: 'owner' | 'admin' | 'member';\n}\n\nexport function GroupInfo({ roomId, onClose, currentUserId }: GroupInfoProps) {\n    const [participants, setParticipants] = useState<Participant[]>([]);\n    const [roomName, setRoomName] = useState(\"\");\n    const [isGroup, setIsGroup] = useState(false);\n    const [loading, setLoading] = useState(true);\n    const [isAdmin, setIsAdmin] = useState(false);\n\n    // For adding members\n    const [searchQuery, setSearchQuery] = useState(\"\");\n    const [searchResults, setSearchResults] = useState<Profile[]>([]);\n    const [showAdd, setShowAdd] = useState(false);\n\n    const supabase = createClient();\n\n    useEffect(() => {\n        fetchDetails();\n    }, [roomId]);\n\n    const fetchDetails = async () => {\n        // Fetch Room\n        const { data: room } = await supabase.from('rooms').select('*').eq('id', roomId).single();\n        if (room) {\n            setRoomName(room.name || \"Chat\");\n            setIsGroup(room.is_group);\n        }\n\n        // Fetch Participants\n        const { data: parts } = await supabase\n            .from('room_participants')\n            .select(`role, profiles(*)`)\n            .eq('room_id', roomId);\n\n        if (parts) {\n            const mapped = parts.map((p: any) => ({\n                ...p.profiles,\n                role: p.role\n            }));\n            setParticipants(mapped);\n\n            const me = mapped.find((p: any) => p.id === currentUserId);\n            if (me && (me.role === 'owner' || me.role === 'admin')) setIsAdmin(true);\n        }\n        setLoading(false);\n    };\n\n    const handleUpdateName = async () => {\n        if (!roomName.trim()) return;\n        await supabase.from('rooms').update({ name: roomName }).eq('id', roomId);\n        alert(\"Group name updated\");\n    };\n\n    const handleSearch = async () => {\n        if (!searchQuery) return;\n        const { data } = await supabase.from('profiles')\n            .select('*')\n            .ilike('username', `%${searchQuery}%`)\n            .limit(5);\n        if (data) setSearchResults(data);\n    };\n\n    const addMember = async (userId: string) => {\n        const { error } = await supabase.from('room_participants').insert({\n            room_id: roomId,\n            user_id: userId,\n            role: 'member'\n        });\n        if (error) alert(error.message);\n        else {\n            alert(\"Member added\");\n            setShowAdd(false);\n            fetchDetails();\n        }\n    };\n\n    const removeMember = async (userId: string) => {\n        if (!confirm(\"Remove this user?\")) return;\n        await supabase.from('room_participants').delete().eq('room_id', roomId).eq('user_id', userId);\n        setParticipants(prev => prev.filter(p => p.id !== userId));\n    };\n\n    const promoteMember = async (userId: string) => {\n        await supabase.from('room_participants').update({ role: 'admin' }).eq('room_id', roomId).eq('user_id', userId);\n        fetchDetails();\n    };\n\n    const leaveGroup = async () => {\n        if (!confirm(\"Leave this group?\")) return;\n        await supabase.from('room_participants').delete().eq('room_id', roomId).eq('user_id', currentUserId);\n        onClose();\n        window.location.href = '/chat';\n    };\n\n    if (loading) return null;\n\n    return (\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4\">\n            <div className=\"w-full max-w-md bg-[#1e1e24] border border-white/10 rounded-2xl shadow-2xl overflow-hidden animate-in fade-in zoom-in-95 duration-200 flex flex-col max-h-[80vh]\">\n                <div className=\"p-4 border-b border-white/5 flex items-center justify-between\">\n                    <h2 className=\"text-lg font-bold text-white\">Group Info</h2>\n                    <button onClick={onClose} className=\"p-2 hover:bg-white/10 rounded-full transition-colors\">\n                        <X className=\"w-5 h-5 text-white/70\" />\n                    </button>\n                </div>\n\n                <div className=\"p-4 overflow-y-auto custom-scrollbar flex-1 space-y-6\">\n                    {/* Header Info */}\n                    <div className=\"flex flex-col items-center gap-3\">\n                        <Avatar fallback={roomName} className=\"w-20 h-20 text-2xl\" />\n                        {isAdmin ? (\n                            <div className=\"flex gap-2 w-full\">\n                                <input\n                                    value={roomName}\n                                    onChange={(e) => setRoomName(e.target.value)}\n                                    className=\"flex-1 bg-white/5 border border-white/10 rounded-lg px-3 py-1 text-center font-bold text-white focus:border-primary outline-none\"\n                                />\n                                <button onClick={handleUpdateName} className=\"text-xs text-primary hover:underline\">Save</button>\n                            </div>\n                        ) : (\n                            <h3 className=\"text-xl font-bold text-white\">{roomName}</h3>\n                        )}\n                        <p className=\"text-xs text-white/40\">{participants.length} members</p>\n                    </div>\n\n                    {/* Actions */}\n                    <div className=\"flex justify-center gap-4\">\n                        {isAdmin && (\n                            <button onClick={() => setShowAdd(!showAdd)} className=\"flex flex-col items-center gap-1 text-primary hover:opacity-80\">\n                                <div className=\"p-3 bg-primary/10 rounded-full\"><UserPlus className=\"w-5 h-5\" /></div>\n                                <span className=\"text-xs\">Add</span>\n                            </button>\n                        )}\n                        <button onClick={leaveGroup} className=\"flex flex-col items-center gap-1 text-red-400 hover:opacity-80\">\n                            <div className=\"p-3 bg-red-500/10 rounded-full\"><LogOut className=\"w-5 h-5\" /></div>\n                            <span className=\"text-xs\">Leave</span>\n                        </button>\n                    </div>\n\n                    {/* Add Member Search */}\n                    {showAdd && (\n                        <div className=\"bg-white/5 p-3 rounded-xl space-y-2 animate-in slide-in-from-top-2\">\n                            <div className=\"flex gap-2\">\n                                <input\n                                    className=\"flex-1 bg-black/20 border border-white/10 rounded-lg px-3 py-2 text-sm text-white\"\n                                    placeholder=\"Search username...\"\n                                    value={searchQuery}\n                                    onChange={(e) => setSearchQuery(e.target.value)}\n                                />\n                                <button onClick={handleSearch} className=\"px-3 bg-primary rounded-lg text-white text-xs\">Search</button>\n                            </div>\n                            <div className=\"space-y-1 max-h-32 overflow-y-auto\">\n                                {searchResults.map(u => (\n                                    <div key={u.id} className=\"flex items-center justify-between p-2 hover:bg-white/5 rounded-lg\">\n                                        <div className=\"flex items-center gap-2\">\n                                            <Avatar src={u.avatar_url || undefined} fallback={u.username || \"?\"} className=\"w-6 h-6\" />\n                                            <span className=\"text-sm text-white\">{u.username}</span>\n                                        </div>\n                                        <button onClick={() => addMember(u.id)} className=\"text-primary text-xs hover:underline\">Add</button>\n                                    </div>\n                                ))}\n                            </div>\n                        </div>\n                    )}\n\n                    {/* Participants List */}\n                    <div>\n                        <h4 className=\"text-sm font-bold text-white/50 mb-2 uppercase tracking-wider\">Participants</h4>\n                        <div className=\"space-y-2\">\n                            {participants.map((p) => (\n                                <div key={p.id} className=\"flex items-center justify-between p-2 rounded-xl hover:bg-white/5 transition-colors group\">\n                                    <div className=\"flex items-center gap-3\">\n                                        <Avatar src={p.avatar_url || undefined} fallback={p.username || \"?\"} />\n                                        <div>\n                                            <p className=\"text-sm font-medium text-white flex items-center gap-1\">\n                                                {p.full_name || p.username}\n                                                {p.role === 'owner' && <ShieldAlert className=\"w-3 h-3 text-yellow-500\" />}\n                                                {p.role === 'admin' && <Shield className=\"w-3 h-3 text-blue-400\" />}\n                                            </p>\n                                            <p className=\"text-xs text-white/40 capitalize\">{p.role}</p>\n                                        </div>\n                                    </div>\n\n                                    {isAdmin && currentUserId !== p.id && (\n                                        <div className=\"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity\">\n                                            {p.role === 'member' && (\n                                                <button onClick={() => promoteMember(p.id)} className=\"p-1 hover:bg-blue-500/20 text-blue-400 rounded\" title=\"Promote\">\n                                                    <Shield className=\"w-4 h-4\" />\n                                                </button>\n                                            )}\n                                            <button onClick={() => removeMember(p.id)} className=\"p-1 hover:bg-red-500/20 text-red-400 rounded\" title=\"Remove\">\n                                                <Trash2 className=\"w-4 h-4\" />\n                                            </button>\n                                        </div>\n                                    )}\n                                </div>\n                            ))}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 518, "column": 0}, "map": {"version":3,"sources":["file:///Users/apple/Desktop/GOSSIP/src/components/chat-window.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState, useRef } from \"react\";\nimport { createClient } from \"@/lib/supabase/client\";\nimport { Avatar } from \"@/components/ui/avatar\";\nimport { ArrowLeft, Mic, Send, Paperclip, X, Image as ImageIcon, Check, CheckCheck, Trash2, Ban, Phone, Video, MoreVertical, Loader2, Square, Reply as ReplyIcon } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { useToast } from \"@/contexts/toast-context\";\nimport { useCall } from \"@/contexts/call-context\";\nimport { Message, MessageType } from \"@/lib/types\";\nimport { GroupInfo } from \"./group-info\";\nimport { useParams, useRouter } from \"next/navigation\";\n\nexport default function ChatWindow({ roomId, user }: { roomId: string; user: any }) {\n    const [messages, setMessages] = useState<Message[]>([]);\n    const [newMessage, setNewMessage] = useState(\"\");\n    const [room, setRoom] = useState<any>(null);\n    const [uploading, setUploading] = useState(false);\n    const [showGroupInfo, setShowGroupInfo] = useState(false);\n    const [recording, setRecording] = useState(false);\n    const [audioBlob, setAudioBlob] = useState<Blob | null>(null);\n    const [replyingTo, setReplyingTo] = useState<Message | null>(null);\n    const [isBlocked, setIsBlocked] = useState(false);\n    const [loading, setLoading] = useState(true);\n    const [headerName, setHeaderName] = useState(\"Chat Room\");\n    const [headerAvatar, setHeaderAvatar] = useState<string | undefined>(undefined);\n    const [headerGender, setHeaderGender] = useState<string | undefined>(undefined);\n\n    const mediaRecorderRef = useRef<MediaRecorder | null>(null);\n    const chunksRef = useRef<Blob[]>([]);\n    const scrollRef = useRef<HTMLDivElement>(null);\n    const fileInputRef = useRef<HTMLInputElement>(null);\n    const supabase = createClient();\n    const router = useRouter();\n\n    const { startCall } = useCall();\n    const { addToast } = useToast();\n\n    useEffect(() => {\n        const fetchRoomAndMessages = async () => {\n            setLoading(true);\n            const { data: roomData } = await supabase\n                .from(\"rooms\")\n                .select(`*, room_participants(user_id, profiles(username, full_name, avatar_url, gender))`)\n                .eq(\"id\", roomId)\n                .single();\n\n            setRoom(roomData);\n\n            if (roomData) {\n                if (roomData.is_group === false && roomData.room_participants) {\n                    const other = roomData.room_participants.find((p: any) => p.user_id !== user.id);\n                    if (other && other.profiles) {\n                        const name = (other.profiles.full_name || other.profiles.username || \"Unknown User\").toUpperCase();\n                        setHeaderName(name);\n                        setHeaderAvatar(other.profiles.avatar_url);\n                        setHeaderGender(other.profiles.gender);\n\n                        const { data: blockData } = await supabase\n                            .from(\"blocked_users\")\n                            .select(\"*\")\n                            .eq(\"blocker_id\", user.id)\n                            .eq(\"blocked_id\", other.user_id)\n                            .maybeSingle();\n\n                        setIsBlocked(!!blockData);\n                    }\n                } else {\n                    setHeaderName((roomData.name || \"Group Chat\").toUpperCase());\n                }\n            }\n\n            const { data: msgData } = await supabase\n                .from(\"messages\")\n                .select(`*, profiles(username, avatar_url, gender), reply_item: messages!reply_to(content, message_type, profiles(username))`)\n                .eq(\"room_id\", roomId)\n                .order(\"created_at\", { ascending: true });\n\n            if (msgData) setMessages(msgData as any);\n            setLoading(false);\n        };\n\n        fetchRoomAndMessages();\n\n        const channel = supabase\n            .channel(`room:${roomId}`)\n            .on(\"postgres_changes\", { event: \"INSERT\", schema: \"public\", table: \"messages\", filter: `room_id=eq.${roomId}` },\n                async (payload) => {\n                    const { data } = await supabase.from(\"messages\").select(`*, profiles(username, avatar_url, gender), reply_item: messages!reply_to(content, message_type, profiles(username))`).eq(\"id\", payload.new.id).single();\n                    if (data) setMessages((prev) => [...prev, data as any]);\n                })\n            .subscribe();\n\n        return () => {\n            supabase.removeChannel(channel);\n        };\n    }, [roomId, user.id, supabase]);\n\n    useEffect(() => {\n        if (scrollRef.current) {\n            scrollRef.current.scrollTop = scrollRef.current.scrollHeight;\n        }\n\n        const unreadIds = messages\n            .filter(m => m.user_id !== user.id && !m.read_at)\n            .map(m => m.id);\n\n        if (unreadIds.length > 0) {\n            supabase\n                .from(\"messages\")\n                .update({ read_at: new Date().toISOString() })\n                .in(\"id\", unreadIds)\n                .then(() => { });\n        }\n    }, [messages, user.id, supabase]);\n\n    const getNameColor = (gender?: string) => {\n        switch (gender?.toLowerCase()) {\n            case 'male': return '#00BFFF';\n            case 'female': return '#FFB6C1';\n            case 'other': return '#FFD700';\n            default: return '#FFF';\n        }\n    };\n\n    const handleSendMessage = async (e?: React.FormEvent, type: MessageType = 'text', mediaUrl?: string, meta?: any) => {\n        if (e) e.preventDefault();\n        if (isBlocked) return;\n\n        let content = type === 'text' ? newMessage : null;\n        if (type === 'text' && !content?.trim()) return;\n\n        if (!content && type !== 'text') {\n            if (type === 'image') content = 'ðŸ“· Image';\n            else if (type === 'video') content = 'ðŸ“¹ Video';\n            else if (type === 'audio') content = 'ðŸŽ¤ Voice Note';\n            else content = 'ðŸ“Ž Attachment';\n        }\n\n        const { error } = await supabase.from(\"messages\").insert({\n            room_id: roomId,\n            user_id: user.id,\n            content: content,\n            message_type: type,\n            media_url: mediaUrl,\n            media_meta: meta,\n            reply_to: replyingTo?.id,\n            status: 'sent',\n            is_deleted: false\n        });\n\n        if (!error) {\n            if (type === 'text') setNewMessage(\"\");\n            setReplyingTo(null);\n\n            // Update room updated_at\n            await supabase.from(\"rooms\").update({ updated_at: new Date().toISOString() }).eq(\"id\", roomId);\n        }\n    };\n\n    const handleFileUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\n        const file = e.target.files?.[0];\n        if (!file || isBlocked) return;\n\n        setUploading(true);\n        const fileName = `${Date.now()}_${file.name}`;\n        const filePath = `${roomId}/${fileName}`;\n\n        const { error: uploadError } = await supabase.storage\n            .from('chat-media')\n            .upload(filePath, file);\n\n        if (uploadError) {\n            addToast(uploadError.message, \"error\");\n            setUploading(false);\n            return;\n        }\n\n        const { data: { publicUrl } } = supabase.storage.from('chat-media').getPublicUrl(filePath);\n\n        let type: MessageType = 'document';\n        if (file.type.startsWith('image/')) type = 'image';\n        else if (file.type.startsWith('video/')) type = 'video';\n        else if (file.type.startsWith('audio/')) type = 'audio';\n\n        await handleSendMessage(undefined, type, publicUrl, { size: file.size, name: file.name });\n        setUploading(false);\n    };\n\n    const handleDeleteMessage = async (messageId: string) => {\n        const { error } = await supabase\n            .from(\"messages\")\n            .update({ content: \"ðŸš« Message deleted\", is_deleted: true, media_url: null, media_meta: null })\n            .eq(\"id\", messageId);\n\n        if (error) addToast(\"Failed to delete message\", \"error\");\n    };\n\n    const startRecording = async () => {\n        if (isBlocked) return;\n        try {\n            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n            const mediaRecorder = new MediaRecorder(stream);\n            mediaRecorderRef.current = mediaRecorder;\n            chunksRef.current = [];\n\n            mediaRecorder.ondataavailable = (e) => {\n                if (e.data.size > 0) chunksRef.current.push(e.data);\n            };\n\n            mediaRecorder.onstop = () => {\n                const blob = new Blob(chunksRef.current, { type: 'audio/webm' });\n                setAudioBlob(blob);\n                stream.getTracks().forEach(track => track.stop());\n            };\n\n            mediaRecorder.start();\n            setRecording(true);\n        } catch (err) {\n            console.error(\"Error accessing microphone:\", err);\n            addToast(\"Could not access microphone\", \"error\");\n        }\n    };\n\n    const stopRecording = () => {\n        if (mediaRecorderRef.current && recording) {\n            mediaRecorderRef.current.stop();\n            setRecording(false);\n        }\n    };\n\n    const cancelRecording = () => {\n        stopRecording();\n        setAudioBlob(null);\n        chunksRef.current = [];\n    };\n\n    const sendVoiceNote = async () => {\n        if (!audioBlob || isBlocked) return;\n        setUploading(true);\n        const fileName = `${Date.now()}.webm`;\n        const filePath = `${roomId}/${fileName}`;\n\n        const { error: uploadError } = await supabase.storage\n            .from('chat-media')\n            .upload(filePath, audioBlob);\n\n        if (uploadError) {\n            addToast(uploadError.message, \"error\");\n            setUploading(false);\n            return;\n        }\n\n        const { data: { publicUrl } } = supabase.storage.from('chat-media').getPublicUrl(filePath);\n        await handleSendMessage(undefined, 'audio', publicUrl, { duration: 0 });\n        setAudioBlob(null);\n        setUploading(false);\n    };\n\n    const handleBlockUser = async () => {\n        if (!room || room.is_group) return;\n        const other = room.room_participants?.find((p: any) => p.user_id !== user?.id);\n        if (!other) return;\n\n        try {\n            if (isBlocked) {\n                await supabase.from(\"blocked_users\").delete().eq(\"blocker_id\", user?.id).eq(\"blocked_id\", other.user_id);\n                setIsBlocked(false);\n                addToast(\"User unblocked\", \"success\");\n            } else {\n                await supabase.from(\"blocked_users\").insert({ blocker_id: user?.id, blocked_id: other.user_id });\n                setIsBlocked(true);\n                addToast(\"User blocked\", \"error\");\n                router.push('/chat');\n            }\n        } catch (err: any) {\n            addToast(\"Action failed\", \"error\");\n        }\n    };\n\n    if (loading) {\n        return (\n            <div className=\"flex-1 flex flex-col items-center justify-center bg-black\">\n                <Loader2 className=\"w-10 h-10 text-primary animate-spin\" />\n                <p className=\"mt-4 text-white/50 font-bold tracking-widest uppercase text-[10px]\">Establishing Secure Line...</p>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"flex flex-col h-full bg-black relative\">\n            {/* Background Glow */}\n            <div className=\"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[600px] h-[600px] bg-primary/5 rounded-full blur-[120px] pointer-events-none\" />\n\n            {/* Chat Header */}\n            <div className=\"px-6 py-4 flex items-center justify-between bg-black/80 backdrop-blur-xl border-b border-white/5 z-20\">\n                <div className=\"flex items-center gap-4\">\n                    <button onClick={() => router.push('/chat')} className=\"p-2 -ml-2 hover:bg-white/5 rounded-xl text-white/30 hover:text-white transition-all\">\n                        <ArrowLeft className=\"w-6 h-6\" strokeWidth={3} />\n                    </button>\n                    <div className=\"relative\">\n                        <div className=\"w-11 h-11 rounded-2xl p-0.5 bg-gradient-to-br from-primary/30 to-secondary/30\">\n                            <Avatar src={headerAvatar} fallback={headerName[0] || \"?\"} className=\"w-full h-full rounded-[14px]\" />\n                        </div>\n                        <div className=\"absolute -bottom-0.5 -right-0.5 w-3.5 h-3.5 bg-online border-[3px] border-black rounded-full shadow-lg shadow-online/20\"></div>\n                    </div>\n                    <div>\n                        <h3 className=\"text-[17px] font-black tracking-tight\" style={{ color: getNameColor(headerGender) }}>{headerName}</h3>\n                        <div className=\"flex items-center gap-1.5 mt-0.5\">\n                            <div className=\"w-1.5 h-1.5 bg-online rounded-full animate-pulse shadow-sm shadow-online\" />\n                            <p className=\"text-[11px] font-black text-primary uppercase tracking-widest\">Active Now</p>\n                        </div>\n                    </div>\n                </div>\n\n                <div className=\"flex items-center gap-1\">\n                    <button onClick={() => startCall(roomId, false)} className=\"p-2.5 hover:bg-white/5 rounded-xl text-white/40 hover:text-primary transition-all\">\n                        <Phone className=\"w-5 h-5\" strokeWidth={2.5} />\n                    </button>\n                    <button onClick={() => startCall(roomId, true)} className=\"p-2.5 hover:bg-white/5 rounded-xl text-white/40 hover:text-secondary transition-all\">\n                        <Video className=\"w-5 h-5\" strokeWidth={2.5} />\n                    </button>\n                    <button onClick={() => setShowGroupInfo(true)} className=\"p-2.5 hover:bg-white/5 rounded-xl text-white/40 hover:text-white transition-all\">\n                        <MoreVertical className=\"w-5 h-5\" strokeWidth={2.5} />\n                    </button>\n                </div>\n            </div>\n\n            {/* Messages Area */}\n            <div className=\"flex-1 overflow-y-auto p-6 space-y-6 custom-scrollbar relative z-10\" ref={scrollRef}>\n                <div className=\"flex justify-center mb-8\">\n                    <div className=\"px-4 py-1 rounded-full bg-white/5 border border-white/10\">\n                        <span className=\"text-[10px] font-black text-white/30 uppercase tracking-[0.2em]\">Today</span>\n                    </div>\n                </div>\n\n                {messages.map((msg, index) => {\n                    const isMe = msg.user_id === user.id;\n                    const prevMsg = messages[index - 1];\n                    const isSameUser = prevMsg?.user_id === msg.user_id;\n\n                    return (\n                        <div key={msg.id} className={cn(\"flex flex-col\", isMe ? \"items-end\" : \"items-start\")}>\n                            {!isMe && !isSameUser && (\n                                <span className=\"text-[10px] font-black text-white/20 mb-1.5 ml-14 uppercase tracking-wider\" style={{ color: getNameColor((msg.profiles as any)?.gender) }}>\n                                    {(msg.profiles as any)?.username}\n                                </span>\n                            )}\n                            <div className={cn(\"flex items-end gap-3 max-w-[85%]\", isMe && \"flex-row-reverse\")}>\n                                {!isMe && (\n                                    <div className=\"w-8 h-8 rounded-xl overflow-hidden ring-1 ring-white/10 flex-shrink-0\">\n                                        {!isSameUser ? (\n                                            <Avatar src={(msg.profiles as any)?.avatar_url || ''} fallback={(msg.profiles as any)?.username?.[0] || \"?\"} className=\"w-full h-full\" />\n                                        ) : <div className=\"w-full h-full\" />}\n                                    </div>\n                                )}\n\n                                <div className={cn(\n                                    \"px-4 py-3 relative group transition-all\",\n                                    isMe\n                                        ? \"bg-primary text-black rounded-[22px] rounded-br-[4px] shadow-lg shadow-primary/10\"\n                                        : \"bg-white/5 text-white rounded-[22px] rounded-bl-[4px] border border-white/5\"\n                                )}>\n                                    {/* Action Buttons */}\n                                    <div className={cn(\n                                        \"absolute -top-8 px-2 py-1 bg-black/60 backdrop-blur-md rounded-xl border border-white/10 flex gap-2 opacity-0 group-hover:opacity-100 transition-all z-20\",\n                                        isMe ? \"right-0\" : \"left-0\"\n                                    )}>\n                                        <button\n                                            onClick={() => setReplyingTo(msg)}\n                                            className=\"text-white/60 hover:text-primary transition-colors\"\n                                        >\n                                            <ReplyIcon size={14} />\n                                        </button>\n                                        {isMe && !msg.is_deleted && (\n                                            <button\n                                                onClick={() => handleDeleteMessage(msg.id)}\n                                                className=\"text-white/60 hover:text-secondary transition-colors\"\n                                            >\n                                                <Trash2 size={14} />\n                                            </button>\n                                        )}\n                                    </div>\n\n                                    {msg.is_deleted ? (\n                                        <p className=\"italic text-[13px] opacity-40 font-medium tracking-tight\">ðŸš« Ghost message deleted</p>\n                                    ) : (\n                                        <>\n                                            {/* Replying To Preview */}\n                                            {msg.reply_item && (\n                                                <div className={cn(\n                                                    \"mb-2 p-2 rounded-xl flex flex-col gap-0.5 border-l-4\",\n                                                    isMe ? \"bg-black/5 border-black/20\" : \"bg-white/5 border-primary/40\"\n                                                )}>\n                                                    <span className={cn(\"text-[9px] font-black uppercase tracking-widest\", isMe ? \"text-black/50\" : \"text-primary/70\")}>\n                                                        {msg.reply_item.profiles?.username || 'GOSSIPER'}\n                                                    </span>\n                                                    <p className={cn(\"text-[11px] font-bold truncate italic opacity-60\", isMe ? \"text-black\" : \"text-white\")}>\n                                                        {msg.reply_item.message_type === 'text' ? msg.reply_item.content : `[MEDIA ${msg.reply_item.message_type.toUpperCase()}]`}\n                                                    </p>\n                                                </div>\n                                            )}\n\n                                            {msg.message_type === 'text' && <p className=\"text-[15px] font-medium leading-relaxed tracking-tight\">{msg.content}</p>}\n                                            {msg.message_type === 'image' && (\n                                                <div className=\"rounded-2xl overflow-hidden my-1 border border-white/10\">\n                                                    <img src={msg.media_url || ''} alt=\"\" className=\"max-w-full max-h-[400px] w-auto h-auto object-cover\" />\n                                                </div>\n                                            )}\n                                        </>\n                                    )}\n\n                                    <div className={cn(\"flex items-center gap-1.5 mt-1.5\", isMe ? \"justify-end\" : \"justify-start\")}>\n                                        <span className={cn(\"text-[10px] font-black uppercase tracking-widest\", isMe ? \"text-black/40\" : \"text-white/20\")}>\n                                            {new Date(msg.created_at).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\n                                        </span>\n                                        {isMe && (\n                                            msg.read_at\n                                                ? <CheckCheck size={12} className=\"text-black/60\" />\n                                                : <Check size={12} className=\"text-black/40\" />\n                                        )}\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    );\n                })}\n                {uploading && (\n                    <div className=\"flex justify-end pr-4\">\n                        <div className=\"bg-primary/20 p-2 rounded-xl flex items-center gap-2 border border-primary/20\">\n                            <Loader2 className=\"w-4 h-4 animate-spin text-primary\" />\n                            <span className=\"text-[11px] font-black text-primary uppercase tracking-widest\">Transmitting...</span>\n                        </div>\n                    </div>\n                )}\n            </div>\n\n            {/* Input Area */}\n            <form onSubmit={(e) => handleSendMessage(e, 'text')} className=\"p-4 bg-background border-t border-divider\">\n                {replyingTo && (\n                    <div className=\"flex items-center justify-between bg-surface/50 p-2 rounded-t-xl border border-primary/20 mb-2 backdrop-blur-sm\">\n                        <div className=\"flex items-center gap-2 overflow-hidden\">\n                            <div className=\"w-1 h-8 bg-primary rounded-full\"></div>\n                            <div className=\"flex flex-col\">\n                                <span className=\"text-small font-bold text-primary\">\n                                    Replying to {\n                                        replyingTo.profiles?.username || 'user'\n                                    }\n                                </span>\n                                <span className=\"text-small text-text-secondary truncate max-w-[200px]\">{replyingTo.content || 'Media message'}</span>\n                            </div>\n                        </div>\n                        <button type=\"button\" onClick={() => setReplyingTo(null)} className=\"p-1 hover:bg-surface rounded-full\">\n                            <X className=\"w-4 h-4 text-text-secondary\" />\n                        </button>\n                    </div>\n                )}\n                <input\n                    type=\"file\"\n                    ref={fileInputRef}\n                    className=\"hidden\"\n                    onChange={handleFileUpload}\n                    accept=\"image/*,video/*,audio/*\"\n                />\n                <div className=\"flex gap-3 items-center bg-surface p-2 pl-4 rounded-xl shadow-reference-sm border border-divider focus-within:border-primary/50 transition-all\">\n                    {recording ? (\n                        <div className=\"flex-1 flex items-center gap-3 animate-pulse\">\n                            <span className=\"text-red-500 text-small font-bold uppercase tracking-wider\">Recording...</span>\n                            <div className=\"w-2 h-2 rounded-full bg-red-500 animate-ping\"></div>\n                        </div>\n                    ) : audioBlob ? (\n                        <div className=\"flex-1 flex items-center gap-3\">\n                            <span className=\"text-small text-primary font-bold\">Voice Note</span>\n                            <audio src={URL.createObjectURL(audioBlob)} controls className=\"h-8 w-40\" />\n                        </div>\n                    ) : (\n                        <>\n                            <button\n                                type=\"button\"\n                                onClick={() => fileInputRef.current?.click()}\n                                className=\"p-2 text-text-secondary hover:text-primary transition-colors\"\n                                disabled={uploading}\n                            >\n                                <Paperclip className=\"w-5 h-5\" />\n                            </button>\n\n                            <input\n                                value={newMessage}\n                                onChange={(e) => setNewMessage(e.target.value)}\n                                placeholder=\"Type a message...\"\n                                className=\"flex-1 bg-transparent border-none outline-none px-2 text-body text-foreground placeholder:text-text-tertiary h-10\"\n                                disabled={uploading}\n                            />\n                        </>\n                    )}\n\n                    {recording ? (\n                        <button type=\"button\" onClick={stopRecording} className=\"p-2 bg-red-500/20 text-red-500 rounded-lg hover:bg-red-500/30\">\n                            <Square className=\"w-4 h-4 fill-current\" />\n                        </button>\n                    ) : audioBlob ? (\n                        <>\n                            <button type=\"button\" onClick={cancelRecording} className=\"p-2 text-text-secondary hover:text-red-400\">\n                                <Trash2 className=\"w-4 h-4\" />\n                            </button>\n                            <button type=\"button\" onClick={sendVoiceNote} className=\"p-2 bg-primary-dark text-white rounded-full h-10 w-10 flex items-center justify-center hover:bg-primary/90 shadow-md\">\n                                <Send className=\"w-4 h-4 ml-0.5\" />\n                            </button>\n                        </>\n                    ) : (\n                        newMessage.trim() ? (\n                            <button\n                                type=\"submit\"\n                                disabled={uploading}\n                                className=\"p-2 bg-primary-dark text-white rounded-full h-10 w-10 flex items-center justify-center hover:bg-primary/90 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-md\"\n                            >\n                                <Send className=\"w-4 h-4 ml-0.5\" />\n                            </button>\n                        ) : (\n                            <button\n                                type=\"button\"\n                                onClick={startRecording}\n                                disabled={uploading}\n                                className=\"p-2 text-text-secondary hover:text-primary transition-all\"\n                            >\n                                <Mic className=\"w-5 h-5\" />\n                            </button>\n                        )\n                    )}\n                </div>\n            </form>\n            {showGroupInfo && <GroupInfo roomId={roomId} onClose={() => setShowGroupInfo(false)} currentUserId={user.id} />}\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}}]
}