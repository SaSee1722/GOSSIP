{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///Users/apple/Desktop/GOSSIP/src/components/user-search.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState } from \"react\";\nimport { createClient } from \"@/lib/supabase/client\";\nimport { Avatar } from \"@/components/ui/avatar\";\nimport { Search, UserPlus, Check, X } from \"lucide-react\";\nimport { Profile } from \"@/lib/types\";\nimport { cn } from \"@/lib/utils\";\nimport { useToast } from \"@/contexts/toast-context\";\n\ninterface UserSearchProps {\n    onClose: () => void;\n    currentUserId: string;\n}\n\nexport function UserSearch({ onClose, currentUserId }: UserSearchProps) {\n    const [query, setQuery] = useState(\"\");\n    const [results, setResults] = useState<Profile[]>([]);\n    const [loading, setLoading] = useState(false);\n    const [requested, setRequested] = useState<Set<string>>(new Set());\n    const supabase = createClient();\n    const { addToast } = useToast();\n\n    const handleSearch = async () => {\n        if (!query.trim()) return;\n        setLoading(true);\n\n        // Simple search by username or full_name\n        const { data, error } = await supabase\n            .from(\"profiles\")\n            .select(\"*\")\n            .or(`username.ilike.%${query}%,full_name.ilike.%${query}%`)\n            .neq(\"id\", currentUserId)\n            .limit(10);\n\n        if (data) {\n            // Filter out already connected users? For now showing all.\n            setResults(data);\n        }\n        setLoading(false);\n    };\n\n    const sendRequest = async (targetId: string) => {\n        // Optimistic update\n        setRequested((prev) => new Set(prev).add(targetId));\n\n        // 1. Check if a connection tuple already exists (in either direction)\n        const { data: existing, error: fetchError } = await supabase\n            .from(\"connections\")\n            .select(\"*\")\n            .or(`and(requester_id.eq.${currentUserId},addressee_id.eq.${targetId}),and(requester_id.eq.${targetId},addressee_id.eq.${currentUserId})`)\n            .maybeSingle();\n\n        if (fetchError) {\n            console.error(\"Error checking connection:\", fetchError);\n            return;\n        }\n\n        let error = null;\n\n        if (existing) {\n            // 2. If exists, handle based on status\n            if (existing.status === 'rejected') {\n                // Re-activate as a new request from me\n                const { error: updateError } = await supabase\n                    .from(\"connections\")\n                    .update({ status: 'pending', requester_id: currentUserId, addressee_id: targetId })\n                    .eq(\"id\", existing.id);\n                error = updateError;\n            } else {\n                // 'pending' or 'accepted' - Do nothing to prevent duplicate key error\n                // The UI already shows a checkmark optimistically\n                console.log(\"Connection already exists or is pending.\");\n            }\n        } else {\n            // 3. New Record\n            const { error: insertError } = await supabase\n                .from(\"connections\")\n                .insert({ requester_id: currentUserId, addressee_id: targetId });\n            error = insertError;\n        }\n\n        if (error) {\n            console.error(\"Failed to send request\", error);\n            // Revert on error\n            setRequested((prev) => {\n                const next = new Set(prev);\n                next.delete(targetId);\n                return next;\n            });\n            addToast(\"Failed to send request: \" + error.message, \"error\");\n        } else {\n            addToast(\"Request sent!\", \"success\");\n        }\n    };\n\n    return (\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4\">\n            <div className=\"w-full max-w-md bg-[#1e1e24] border border-white/10 rounded-2xl shadow-2xl overflow-hidden animate-in fade-in zoom-in-95 duration-200\">\n                <div className=\"p-4 border-b border-white/5 flex items-center justify-between\">\n                    <h2 className=\"text-lg font-bold text-white\">Find People</h2>\n                    <button onClick={onClose} className=\"p-2 hover:bg-white/10 rounded-full transition-colors\">\n                        <X className=\"w-5 h-5 text-white/70\" />\n                    </button>\n                </div>\n\n                <div className=\"p-4 space-y-4\">\n                    <div className=\"flex gap-2\">\n                        <div className=\"relative flex-1\">\n                            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-white/50\" />\n                            <input\n                                type=\"text\"\n                                placeholder=\"Search by username...\"\n                                className=\"w-full bg-white/5 border border-white/10 rounded-xl py-2 pl-9 pr-4 text-white placeholder:text-white/30 focus:outline-none focus:ring-2 focus:ring-primary/50 transition-all\"\n                                value={query}\n                                onChange={(e) => setQuery(e.target.value)}\n                                onKeyDown={(e) => e.key === 'Enter' && handleSearch()}\n                            />\n                        </div>\n                        <button\n                            onClick={handleSearch}\n                            disabled={loading}\n                            className=\"px-4 py-2 bg-primary text-primary-foreground font-medium rounded-xl hover:bg-primary/90 transition-colors disabled:opacity-50\"\n                        >\n                            {loading ? \"...\" : \"Search\"}\n                        </button>\n                    </div>\n\n                    <div className=\"space-y-2 max-h-[300px] overflow-y-auto custom-scrollbar\">\n                        {results.length === 0 && !loading && query && (\n                            <p className=\"text-center text-white/30 py-4\">No users found.</p>\n                        )}\n\n                        {results.map((user) => (\n                            <div key={user.id} className=\"flex items-center gap-3 p-3 rounded-xl hover:bg-white/5 border border-transparent hover:border-white/5 transition-all\">\n                                <Avatar src={user.avatar_url || undefined} fallback={user.username || user.full_name || \"?\"} />\n                                <div className=\"flex-1 overflow-hidden\">\n                                    <p className=\"font-semibold text-white truncate\">{user.full_name || user.username || \"Unknown\"}</p>\n                                    <p className=\"text-xs text-white/50 truncate\">@{user.username}</p>\n                                </div>\n                                <button\n                                    onClick={() => sendRequest(user.id)}\n                                    disabled={requested.has(user.id)}\n                                    className={cn(\n                                        \"p-2 rounded-full transition-all\",\n                                        requested.has(user.id) ? \"bg-green-500/20 text-green-400\" : \"bg-primary/10 text-primary hover:bg-primary/20\"\n                                    )}\n                                >\n                                    {requested.has(user.id) ? <Check className=\"w-4 h-4\" /> : <UserPlus className=\"w-4 h-4\" />}\n                                </button>\n                            </div>\n                        ))}\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AARA;;;;;;;;AAeO,SAAS,WAAW,EAAE,OAAO,EAAE,aAAa,EAAmB;IAClE,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,sOAAQ,EAAC;IACnC,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,sOAAQ,EAAY,EAAE;IACpD,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,sOAAQ,EAAC;IACvC,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,sOAAQ,EAAc,IAAI;IAC5D,MAAM,WAAW,IAAA,qKAAY;IAC7B,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAA,qKAAQ;IAE7B,MAAM,eAAe;QACjB,IAAI,CAAC,MAAM,IAAI,IAAI;QACnB,WAAW;QAEX,yCAAyC;QACzC,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SACzB,IAAI,CAAC,YACL,MAAM,CAAC,KACP,EAAE,CAAC,CAAC,gBAAgB,EAAE,MAAM,mBAAmB,EAAE,MAAM,CAAC,CAAC,EACzD,GAAG,CAAC,MAAM,eACV,KAAK,CAAC;QAEX,IAAI,MAAM;YACN,2DAA2D;YAC3D,WAAW;QACf;QACA,WAAW;IACf;IAEA,MAAM,cAAc,OAAO;QACvB,oBAAoB;QACpB,aAAa,CAAC,OAAS,IAAI,IAAI,MAAM,GAAG,CAAC;QAEzC,sEAAsE;QACtE,MAAM,EAAE,MAAM,QAAQ,EAAE,OAAO,UAAU,EAAE,GAAG,MAAM,SAC/C,IAAI,CAAC,eACL,MAAM,CAAC,KACP,EAAE,CAAC,CAAC,oBAAoB,EAAE,cAAc,iBAAiB,EAAE,SAAS,sBAAsB,EAAE,SAAS,iBAAiB,EAAE,cAAc,CAAC,CAAC,EACxI,WAAW;QAEhB,IAAI,YAAY;YACZ,QAAQ,KAAK,CAAC,8BAA8B;YAC5C;QACJ;QAEA,IAAI,QAAQ;QAEZ,IAAI,UAAU;YACV,uCAAuC;YACvC,IAAI,SAAS,MAAM,KAAK,YAAY;gBAChC,uCAAuC;gBACvC,MAAM,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,SAChC,IAAI,CAAC,eACL,MAAM,CAAC;oBAAE,QAAQ;oBAAW,cAAc;oBAAe,cAAc;gBAAS,GAChF,EAAE,CAAC,MAAM,SAAS,EAAE;gBACzB,QAAQ;YACZ,OAAO;gBACH,sEAAsE;gBACtE,kDAAkD;gBAClD,QAAQ,GAAG,CAAC;YAChB;QACJ,OAAO;YACH,gBAAgB;YAChB,MAAM,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,SAChC,IAAI,CAAC,eACL,MAAM,CAAC;gBAAE,cAAc;gBAAe,cAAc;YAAS;YAClE,QAAQ;QACZ;QAEA,IAAI,OAAO;YACP,QAAQ,KAAK,CAAC,0BAA0B;YACxC,kBAAkB;YAClB,aAAa,CAAC;gBACV,MAAM,OAAO,IAAI,IAAI;gBACrB,KAAK,MAAM,CAAC;gBACZ,OAAO;YACX;YACA,SAAS,6BAA6B,MAAM,OAAO,EAAE;QACzD,OAAO;YACH,SAAS,iBAAiB;QAC9B;IACJ;IAEA,qBACI,mQAAC;QAAI,WAAU;kBACX,cAAA,mQAAC;YAAI,WAAU;;8BACX,mQAAC;oBAAI,WAAU;;sCACX,mQAAC;4BAAG,WAAU;sCAA+B;;;;;;sCAC7C,mQAAC;4BAAO,SAAS;4BAAS,WAAU;sCAChC,cAAA,mQAAC,sNAAC;gCAAC,WAAU;;;;;;;;;;;;;;;;;8BAIrB,mQAAC;oBAAI,WAAU;;sCACX,mQAAC;4BAAI,WAAU;;8CACX,mQAAC;oCAAI,WAAU;;sDACX,mQAAC,qOAAM;4CAAC,WAAU;;;;;;sDAClB,mQAAC;4CACG,MAAK;4CACL,aAAY;4CACZ,WAAU;4CACV,OAAO;4CACP,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;4CACxC,WAAW,CAAC,IAAM,EAAE,GAAG,KAAK,WAAW;;;;;;;;;;;;8CAG/C,mQAAC;oCACG,SAAS;oCACT,UAAU;oCACV,WAAU;8CAET,UAAU,QAAQ;;;;;;;;;;;;sCAI3B,mQAAC;4BAAI,WAAU;;gCACV,QAAQ,MAAM,KAAK,KAAK,CAAC,WAAW,uBACjC,mQAAC;oCAAE,WAAU;8CAAiC;;;;;;gCAGjD,QAAQ,GAAG,CAAC,CAAC,qBACV,mQAAC;wCAAkB,WAAU;;0DACzB,mQAAC,iKAAM;gDAAC,KAAK,KAAK,UAAU,IAAI;gDAAW,UAAU,KAAK,QAAQ,IAAI,KAAK,SAAS,IAAI;;;;;;0DACxF,mQAAC;gDAAI,WAAU;;kEACX,mQAAC;wDAAE,WAAU;kEAAqC,KAAK,SAAS,IAAI,KAAK,QAAQ,IAAI;;;;;;kEACrF,mQAAC;wDAAE,WAAU;;4DAAiC;4DAAE,KAAK,QAAQ;;;;;;;;;;;;;0DAEjE,mQAAC;gDACG,SAAS,IAAM,YAAY,KAAK,EAAE;gDAClC,UAAU,UAAU,GAAG,CAAC,KAAK,EAAE;gDAC/B,WAAW,IAAA,8IAAE,EACT,mCACA,UAAU,GAAG,CAAC,KAAK,EAAE,IAAI,mCAAmC;0DAG/D,UAAU,GAAG,CAAC,KAAK,EAAE,kBAAI,mQAAC,kOAAK;oDAAC,WAAU;;;;;yEAAe,mQAAC,+OAAQ;oDAAC,WAAU;;;;;;;;;;;;uCAd5E,KAAK,EAAE;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuB7C"}},
    {"offset": {"line": 301, "column": 0}, "map": {"version":3,"sources":["file:///Users/apple/Desktop/GOSSIP/src/components/connection-requests.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { createClient } from \"@/lib/supabase/client\";\nimport { Avatar } from \"@/components/ui/avatar\";\nimport { Check, X, UserCheck, MessageCircle } from \"lucide-react\";\nimport { Connection } from \"@/lib/types\";\nimport { useRouter } from \"next/navigation\";\n\ninterface ConnectionRequestsProps {\n    onClose: () => void;\n    currentUserId: string;\n}\n\nexport function ConnectionRequests({ onClose, currentUserId }: ConnectionRequestsProps) {\n    const [requests, setRequests] = useState<Connection[]>([]);\n    const [loading, setLoading] = useState(true);\n    const supabase = createClient();\n    const router = useRouter();\n\n    useEffect(() => {\n        fetchRequests();\n    }, []);\n\n    const fetchRequests = async () => {\n        const { data, error } = await supabase\n            .from(\"connections\")\n            .select(\"*, requester:profiles!requester_id(*)\")\n            .eq(\"addressee_id\", currentUserId)\n            .eq(\"status\", \"pending\");\n\n        if (data) {\n            setRequests(data as any); // Cast because Supabase joined types are tricky\n        }\n        setLoading(false);\n    };\n\n    const handleResponse = async (id: string, status: 'accepted' | 'rejected') => {\n        const { error } = await supabase\n            .from(\"connections\")\n            .update({ status })\n            .eq(\"id\", id);\n\n        if (!error) {\n            setRequests((prev) => prev.filter(req => req.id !== id));\n            if (status === 'accepted') {\n                // Find and get request details to get the other user ID\n                const req = requests.find(r => r.id === id);\n                if (req) {\n                    await getOrCreateDm(req.requester_id);\n                }\n            }\n        }\n    };\n\n    const getOrCreateDm = async (otherUserId: string) => {\n        setLoading(true);\n        // 1. Check if a DM room already exists\n        // This is a bit complex in Supabase SQL without a function, but we can try a simple creating approach\n        // or just create a new one for now and rely on unique constraints if we had them (we might not).\n        // Better approach: Create a new room with is_group=false. \n        // Real-world app would query room_participants to find common room.\n\n        // Let's create a new DM room for simplicity and reliability in this session\n        const { data: roomData, error: roomError } = await supabase\n            .from(\"rooms\")\n            .insert({ is_group: false, name: \"Direct Message\" }) // Name is often ignored for DMs in UI\n            .select()\n            .single();\n\n        if (roomData) {\n            // Add participants\n            await supabase.from(\"room_participants\").insert([\n                { room_id: roomData.id, user_id: currentUserId },\n                { room_id: roomData.id, user_id: otherUserId }\n            ]);\n\n            onClose();\n            router.push(`/chat?roomId=${roomData.id}`);\n        } else {\n            console.error(\"Failed to create room\", roomError);\n            setLoading(false);\n        }\n    };\n\n    return (\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4\">\n            <div className=\"w-full max-w-md bg-[#1e1e24] border border-white/10 rounded-2xl shadow-2xl overflow-hidden animate-in fade-in zoom-in-95 duration-200\">\n                <div className=\"p-4 border-b border-white/5 flex items-center justify-between\">\n                    <h2 className=\"text-lg font-bold text-white flex items-center gap-2\">\n                        <UserCheck className=\"w-5 h-5 text-primary\" />\n                        Connection Requests\n                    </h2>\n                    <button onClick={onClose} className=\"p-2 hover:bg-white/10 rounded-full transition-colors\">\n                        <X className=\"w-5 h-5 text-white/70\" />\n                    </button>\n                </div>\n\n                <div className=\"p-4 space-y-2 max-h-[400px] overflow-y-auto custom-scrollbar\">\n                    {loading && <p className=\"text-center text-white/30 py-4\">Loading...</p>}\n                    {!loading && requests.length === 0 && (\n                        <div className=\"text-center text-white/30 py-8 flex flex-col items-center gap-2\">\n                            <UserCheck className=\"w-10 h-10 opacity-20\" />\n                            <p>No pending requests.</p>\n                        </div>\n                    )}\n\n                    {requests.map((req) => (\n                        <div key={req.id} className=\"flex items-center gap-3 p-3 rounded-xl bg-white/5 border border-white/5\">\n                            <Avatar\n                                src={req.requester?.avatar_url || undefined}\n                                fallback={req.requester?.username || \"?\"}\n                            />\n                            <div className=\"flex-1 overflow-hidden\">\n                                <p className=\"font-semibold text-white truncate\">\n                                    {req.requester?.full_name || req.requester?.username || \"Unknown User\"}\n                                </p>\n                                <p className=\"text-xs text-white/50 truncate\">\n                                    wants to connect\n                                </p>\n                            </div>\n                            <div className=\"flex items-center gap-1\">\n                                <button\n                                    onClick={() => handleResponse(req.id, 'accepted')}\n                                    className=\"p-2 bg-green-500/20 text-green-400 hover:bg-green-500/30 rounded-full transition-colors\"\n                                    title=\"Accept\"\n                                >\n                                    <Check className=\"w-4 h-4\" />\n                                </button>\n                                <button\n                                    onClick={() => handleResponse(req.id, 'rejected')}\n                                    className=\"p-2 bg-red-500/20 text-red-400 hover:bg-red-500/30 rounded-full transition-colors\"\n                                    title=\"Reject\"\n                                >\n                                    <X className=\"w-4 h-4\" />\n                                </button>\n                            </div>\n                        </div>\n                    ))}\n                </div>\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 567, "column": 0}, "map": {"version":3,"sources":["file:///Users/apple/Desktop/GOSSIP/src/components/settings-modal.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { createClient } from \"@/lib/supabase/client\";\nimport { X, Shield, Eye, EyeOff, UserX, Loader2, Unlock } from \"lucide-react\";\nimport { Avatar } from \"@/components/ui/avatar\";\nimport { useToast } from \"@/contexts/toast-context\";\n\nexport function SettingsModal({ onClose, user }: { onClose: () => void; user: any }) {\n    const [lastSeenEnabled, setLastSeenEnabled] = useState(true);\n    const [blockedUsers, setBlockedUsers] = useState<any[]>([]);\n    const [loading, setLoading] = useState(true);\n    const supabase = createClient();\n    const { addToast } = useToast();\n\n    useEffect(() => {\n        const fetchSettings = async () => {\n            // Fetch profile settings\n            const { data: profile } = await supabase.from(\"profiles\").select(\"last_seen_enabled\").eq(\"id\", user.id).single();\n            if (profile) setLastSeenEnabled(profile.last_seen_enabled);\n\n            // Fetch blocked users\n            const { data: blocks } = await supabase\n                .from(\"blocked_users\")\n                .select(`\n                    *,\n                    blocked:profiles!blocked_id(*)\n                `)\n                .eq(\"blocker_id\", user.id);\n\n            if (blocks) setBlockedUsers(blocks);\n            setLoading(false);\n        };\n\n        fetchSettings();\n    }, [user.id, supabase]);\n\n    const toggleLastSeen = async () => {\n        const newValue = !lastSeenEnabled;\n        setLastSeenEnabled(newValue);\n        await supabase.from(\"profiles\").update({ last_seen_enabled: newValue }).eq(\"id\", user.id);\n    };\n\n    const unblockUser = async (blockId: string) => {\n        const { error } = await supabase.from(\"blocked_users\").delete().eq(\"id\", blockId);\n        if (!error) {\n            setBlockedUsers(prev => prev.filter(b => b.id !== blockId));\n            addToast(\"User unblocked\", \"success\");\n        } else {\n            addToast(\"Failed to unblock\", \"error\");\n        }\n    };\n\n    return (\n        <div className=\"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4\">\n            <div className=\"bg-[#1F2125] border border-white/10 w-full max-w-md rounded-2xl shadow-2xl overflow-hidden font-sans\">\n                <div className=\"p-4 border-b border-white/5 flex items-center justify-between\">\n                    <h2 className=\"text-xl font-bold text-white flex items-center gap-2\">\n                        <Shield className=\"w-5 h-5 text-primary\" />\n                        Privacy Settings\n                    </h2>\n                    <button onClick={onClose} className=\"p-2 hover:bg-white/5 rounded-full text-gray-400 hover:text-white transition-colors\">\n                        <X className=\"w-5 h-5\" />\n                    </button>\n                </div>\n\n                <div className=\"p-6 space-y-8\">\n                    {/* Last Seen Section */}\n                    <div className=\"space-y-4\">\n                        <div className=\"flex items-center justify-between\">\n                            <div className=\"space-y-1\">\n                                <h3 className=\"text-base font-semibold text-white flex items-center gap-2\">\n                                    <Eye className=\"w-4 h-4 text-gray-400\" />\n                                    Last Seen Status\n                                </h3>\n                                <p className=\"text-xs text-gray-500\">Allow others to see when you were last active</p>\n                            </div>\n                            <button\n                                onClick={toggleLastSeen}\n                                className={`w-12 h-6 rounded-full p-1 transition-colors duration-200 ease-in-out ${lastSeenEnabled ? 'bg-primary' : 'bg-white/10'}`}\n                            >\n                                <div className={`w-4 h-4 bg-white rounded-full shadow-sm transform transition-transform duration-200 ${lastSeenEnabled ? 'translate-x-6' : 'translate-x-0'}`} />\n                            </button>\n                        </div>\n                    </div>\n\n                    <hr className=\"border-white/5\" />\n\n                    {/* Blocked Users Section */}\n                    <div className=\"space-y-4\">\n                        <div className=\"space-y-1\">\n                            <h3 className=\"text-base font-semibold text-white flex items-center gap-2\">\n                                <UserX className=\"w-4 h-4 text-gray-400\" />\n                                Blocked Users\n                            </h3>\n                            <p className=\"text-xs text-gray-500\">Manage users you have blocked</p>\n                        </div>\n\n                        {loading ? (\n                            <div className=\"flex justify-center p-4\">\n                                <Loader2 className=\"w-6 h-6 animate-spin text-primary\" />\n                            </div>\n                        ) : blockedUsers.length === 0 ? (\n                            <p className=\"text-sm text-gray-600 italic text-center py-2\">No blocked users</p>\n                        ) : (\n                            <div className=\"space-y-2 max-h-[200px] overflow-y-auto pr-2 custom-scrollbar\">\n                                {blockedUsers.map((block) => (\n                                    <div key={block.id} className=\"flex items-center justify-between bg-black/20 p-2 rounded-lg border border-white/5\">\n                                        <div className=\"flex items-center gap-3\">\n                                            <Avatar src={block.blocked?.avatar_url} fallback={block.blocked?.username?.[0] || \"?\"} className=\"w-8 h-8\" />\n                                            <span className=\"text-sm text-gray-300\">{block.blocked?.username || \"Unknown\"}</span>\n                                        </div>\n                                        <button\n                                            onClick={() => unblockUser(block.id)}\n                                            className=\"text-xs text-red-400 hover:text-red-300 px-3 py-1 bg-red-400/10 hover:bg-red-400/20 rounded-md transition-colors flex items-center gap-1\"\n                                        >\n                                            <Unlock className=\"w-3 h-3\" /> Unblock\n                                        </button>\n                                    </div>\n                                ))}\n                            </div>\n                        )}\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 895, "column": 0}, "map": {"version":3,"sources":["file:///Users/apple/Desktop/GOSSIP/src/components/ui/gradient-text.tsx"],"sourcesContent":["\"use client\";\n\nimport React from \"react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface GradientTextProps {\n    text: string;\n    className?: string;\n    colors?: [string, string];\n}\n\nexport function GradientText({ text, className, colors = ['#00BFFF', '#FFB6C1'] }: GradientTextProps) {\n    return (\n        <span\n            className={cn(\"bg-clip-text text-transparent\", className)}\n            style={{\n                backgroundImage: `linear-gradient(to right, ${colors[0]}, ${colors[1]})`,\n                WebkitBackgroundClip: 'text',\n                WebkitTextFillColor: 'transparent'\n            }}\n        >\n            {text}\n        </span>\n    );\n}\n"],"names":[],"mappings":";;;;;AAGA;AAHA;;;AAWO,SAAS,aAAa,EAAE,IAAI,EAAE,SAAS,EAAE,SAAS;IAAC;IAAW;CAAU,EAAqB;IAChG,qBACI,mQAAC;QACG,WAAW,IAAA,8IAAE,EAAC,iCAAiC;QAC/C,OAAO;YACH,iBAAiB,CAAC,0BAA0B,EAAE,MAAM,CAAC,EAAE,CAAC,EAAE,EAAE,MAAM,CAAC,EAAE,CAAC,CAAC,CAAC;YACxE,sBAAsB;YACtB,qBAAqB;QACzB;kBAEC;;;;;;AAGb"}},
    {"offset": {"line": 926, "column": 0}, "map": {"version":3,"sources":["file:///Users/apple/Desktop/GOSSIP/src/components/sidebar.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { createClient } from \"@/lib/supabase/client\";\nimport { Avatar } from \"@/components/ui/avatar\";\nimport Link from \"next/link\";\nimport { usePathname } from \"next/navigation\";\nimport { cn } from \"@/lib/utils\";\nimport { LogOut, MessageSquare, Plus, Search, UserPlus } from \"lucide-react\";\nimport { useRouter, useSearchParams } from \"next/navigation\";\nimport { UserSearch } from \"./user-search\";\nimport { ConnectionRequests } from \"./connection-requests\";\nimport { SettingsModal } from \"./settings-modal\";\nimport { Settings } from \"lucide-react\";\n\nimport { GradientText } from \"./ui/gradient-text\";\n\ninterface Room {\n    id: string;\n    name: string | null;\n    is_group: boolean;\n    last_message?: string;\n    updated_at: string;\n    room_participants?: {\n        user_id: string;\n        profiles: {\n            username: string;\n            full_name: string;\n            avatar_url: string;\n            gender?: string;\n        }\n    }[];\n}\n\ninterface Connection {\n    id: string;\n    addressee_id: string;\n    requester_id: string;\n    status: string;\n    requester?: { username: string; avatar_url: string; full_name: string; gender?: string };\n    addressee?: { username: string; avatar_url: string; full_name: string; gender?: string };\n}\n\nexport function Sidebar({ user }: { user: any }) {\n    const [rooms, setRooms] = useState<Room[]>([]);\n    const [matches, setMatches] = useState<Connection[]>([]);\n    const [showSearch, setShowSearch] = useState(false);\n    const [showRequests, setShowRequests] = useState(false);\n    const [showSettings, setShowSettings] = useState(false);\n    const [pendingCount, setPendingCount] = useState(0);\n    const [blockedIds, setBlockedIds] = useState<Set<string>>(new Set());\n    const supabase = createClient();\n    const pathname = usePathname();\n    const searchParams = useSearchParams();\n    const router = useRouter();\n    const currentRoomId = searchParams.get(\"roomId\");\n\n    useEffect(() => {\n        const fetchRooms = async () => {\n            const { data } = await supabase\n                .from(\"rooms\")\n                .select(`\n                    *,\n                    room_participants(\n                        user_id,\n                        profiles(username, full_name, avatar_url, gender)\n                    )\n                `)\n                .order(\"updated_at\", { ascending: false });\n\n            if (data) setRooms(data as any);\n        };\n\n        const fetchPendingCount = async () => {\n            const { count } = await supabase\n                .from(\"connections\")\n                .select(\"*\", { count: 'exact', head: true })\n                .eq(\"addressee_id\", user?.id)\n                .eq(\"status\", \"pending\");\n            setPendingCount(count || 0);\n\n            const { data: matchesData } = await supabase\n                .from(\"connections\")\n                .select(`\n                    *,\n                    requester:profiles!requester_id(username, avatar_url, full_name, gender),\n                    addressee:profiles!addressee_id(username, avatar_url, full_name, gender)\n                `)\n                .or(`requester_id.eq.${user.id},addressee_id.eq.${user.id}`)\n                .eq(\"status\", \"accepted\")\n                .limit(10);\n\n            if (matchesData) setMatches(matchesData as any);\n\n            const { data: blocks } = await supabase\n                .from(\"blocked_users\")\n                .select(\"blocked_id\")\n                .eq(\"blocker_id\", user.id);\n\n            if (blocks) {\n                setBlockedIds(new Set(blocks.map(b => b.blocked_id)));\n            }\n        };\n\n        if (user) {\n            fetchRooms();\n            fetchPendingCount();\n        }\n\n        const roomChannel = supabase\n            .channel(\"rooms_realtime\")\n            .on(\"postgres_changes\", { event: \"*\", schema: \"public\", table: \"rooms\" }, () => fetchRooms())\n            .subscribe();\n\n        const connectionChannel = supabase\n            .channel(\"connections_sidebar\")\n            .on(\"postgres_changes\", { event: \"*\", schema: \"public\", table: \"connections\" }, () => fetchPendingCount())\n            .subscribe();\n\n        return () => {\n            supabase.removeChannel(roomChannel);\n            supabase.removeChannel(connectionChannel);\n        };\n    }, [user, supabase]);\n\n    const handleCreateRoom = async () => {\n        const name = prompt(\"Enter room name:\");\n        if (!name) return;\n\n        const { data, error } = await supabase.from(\"rooms\").insert({ name, is_group: true, updated_at: new Date().toISOString() }).select().single();\n        if (error) alert(error.message);\n        else {\n            await supabase.from(\"room_participants\").insert({ room_id: data.id, user_id: user.id });\n            router.push(`/chat?roomId=${data.id}`);\n        }\n    };\n\n    const handleLogout = async () => {\n        await supabase.auth.signOut();\n        router.push(\"/login\");\n    };\n\n    const getNameColor = (gender?: string) => {\n        switch (gender?.toLowerCase()) {\n            case 'male': return '#00BFFF';\n            case 'female': return '#FFB6C1';\n            case 'other': return '#FFD700';\n            default: return '#FFF';\n        }\n    };\n\n    const formatTime = (dateStr: string) => {\n        if (!dateStr) return \"\";\n        const date = new Date(dateStr);\n        const now = new Date();\n        const diff = now.getTime() - date.getTime();\n        const minutes = Math.floor(diff / 60000);\n        if (minutes < 1) return 'Just now';\n        if (minutes < 60) return `${minutes}m`;\n        const hours = Math.floor(minutes / 60);\n        if (hours < 24) return `${hours}h`;\n        return date.toLocaleDateString([], { month: 'short', day: 'numeric' });\n    };\n\n    return (\n        <>\n            <aside className=\"w-full h-full bg-black text-foreground flex flex-col font-sans border-r border-white/5 overflow-hidden\">\n                {/* Header */}\n                <div className=\"p-6 pb-2\">\n                    <div className=\"flex justify-between items-center mb-1\">\n                        <div className=\"flex items-center gap-3\">\n                            <GradientText text=\"GOSSIP.\" className=\"text-[32px] font-black tracking-wider\" />\n                            <div className=\"w-10 h-10 bg-white/5 rounded-xl flex items-center justify-center text-primary\">\n                                <Plus className=\"w-7 h-7\" strokeWidth={3} />\n                            </div>\n                        </div>\n                        <button\n                            onClick={() => setShowRequests(true)}\n                            className=\"relative p-2 rounded-xl border border-white/10 hover:bg-white/5 transition-all\"\n                        >\n                            <UserPlus className=\"w-7 h-7 text-white\" />\n                            {pendingCount > 0 && (\n                                <span className=\"absolute -top-1 -right-1 flex h-5 w-5 items-center justify-center rounded-full bg-primary text-[10px] font-black text-black border-2 border-black\">\n                                    {pendingCount}\n                                </span>\n                            )}\n                        </button>\n                    </div>\n                    <p className=\"text-[13px] text-text-tertiary font-medium mb-8\">Connect, share, and whisper in style.</p>\n                </div>\n\n                {/* Search Bar */}\n                <div className=\"px-6 mb-8\">\n                    <div className=\"bg-white/5 h-12 rounded-[24px] flex items-center px-5 gap-3 border border-white/10 focus-within:border-primary/50 transition-all\">\n                        <Search className=\"w-5 h-5 text-white/30\" />\n                        <input\n                            placeholder=\"Search friends or gossip...\"\n                            className=\"bg-transparent border-none outline-none text-sm w-full placeholder:text-white/20 text-white font-medium\"\n                            readOnly\n                            onClick={() => setShowSearch(true)}\n                        />\n                    </div>\n                </div>\n\n                {/* Connections Rail */}\n                {matches.length > 0 && (\n                    <div className=\"px-6 mb-8\">\n                        <h3 className=\"text-[11px] font-black tracking-[0.2em] text-white/20 mb-4 uppercase\">Connections</h3>\n                        <div className=\"flex gap-5 overflow-x-auto pb-2 scrollbar-hide\">\n                            <button onClick={() => setShowSearch(true)} className=\"flex flex-col items-center gap-3 min-w-[58px]\">\n                                <div className=\"w-[58px] h-[58px] rounded-full border-2 border-dashed border-white/10 hover:border-primary flex items-center justify-center text-white/20 hover:text-primary transition-colors bg-white/5\">\n                                    <Search className=\"w-6 h-6\" />\n                                </div>\n                                <span className=\"text-[11px] font-bold text-white/40\">Find</span>\n                            </button>\n\n                            {matches.map((match) => {\n                                const isRequester = match.requester_id === user.id;\n                                const profile = isRequester ? match.addressee : match.requester;\n                                if (!profile) return null;\n\n                                return (\n                                    <div key={match.id} className=\"flex flex-col items-center gap-3 min-w-[58px]\">\n                                        <div className=\"relative p-0.5 rounded-full border-2 border-primary-dark\">\n                                            <Avatar src={profile.avatar_url} fallback={profile.username?.[0] || \"?\"} className=\"w-[58px] h-[58px]\" />\n                                            <span className=\"absolute bottom-1 right-1 w-3.5 h-3.5 bg-online border-2 border-black rounded-full\"></span>\n                                        </div>\n                                        <span className=\"text-[11px] font-black text-center truncate w-full text-white tracking-tight uppercase\">{profile.username}</span>\n                                    </div>\n                                );\n                            })}\n                        </div>\n                    </div>\n                )}\n\n                {/* Recent Gossips Section Header */}\n                <div className=\"px-6 mb-4 flex items-center gap-3\">\n                    <h3 className=\"text-[11px] font-black tracking-[0.2em] text-white/20 uppercase\">Recent Gossips</h3>\n                    <img src=\"/gossip_illustration.png\" alt=\"\" className=\"w-12 h-12 -mt-4 opacity-50\" />\n                </div>\n\n                {/* Chat List */}\n                <div className=\"flex-1 overflow-y-auto custom-scrollbar\">\n                    <div className=\"space-y-1\">\n                        {rooms.filter(room => {\n                            const other = room.room_participants?.find(p => p.user_id !== user?.id);\n                            if (other && blockedIds.has(other.user_id)) return false;\n                            return true;\n                        }).map((room) => {\n                            let displayName = room.name || \"UNNAMED CHAT\";\n                            let displayAvatar = undefined;\n                            let isOnline = false;\n                            let gender = undefined;\n\n                            if (room.room_participants) {\n                                const other = room.room_participants.find(p => p.user_id !== user?.id);\n                                if (other && other.profiles) {\n                                    displayName = (other.profiles.full_name || other.profiles.username || \"Unknown User\").toUpperCase();\n                                    displayAvatar = other.profiles.avatar_url;\n                                    isOnline = true;\n                                    gender = other.profiles.gender;\n                                }\n                            }\n\n                            const isActive = currentRoomId === room.id;\n\n                            return (\n                                <Link href={`/chat?roomId=${room.id}`} key={room.id} className=\"block group\">\n                                    <div className={cn(\n                                        \"px-6 py-3 transition-all cursor-pointer flex items-center gap-4\",\n                                        isActive ? \"bg-primary/10\" : \"hover:bg-white/[0.03]\"\n                                    )}>\n                                        <div className=\"relative\">\n                                            <Avatar\n                                                src={displayAvatar}\n                                                fallback={displayName[0] || \"?\"}\n                                                className=\"w-[58px] h-[58px] rounded-full ring-2 ring-white/5\"\n                                            />\n                                            {isOnline && (\n                                                <span className=\"absolute bottom-0 right-1 w-4 h-4 bg-online border-[3px] border-black rounded-full\"></span>\n                                            )}\n                                        </div>\n                                        <div className=\"overflow-hidden flex-1 border-b border-white/5 pb-3 group-last:border-none\">\n                                            <div className=\"flex justify-between items-center mb-1\">\n                                                <p className=\"text-[16px] font-black tracking-tight truncate\" style={{ color: getNameColor(gender) }}>\n                                                    {displayName}\n                                                </p>\n                                                <p className=\"text-[11px] font-bold text-white/20\">\n                                                    {formatTime(room.updated_at)}\n                                                </p>\n                                            </div>\n                                            <div className=\"flex justify-between items-center\">\n                                                <p className={cn(\"text-xs truncate flex-1 pr-2 font-medium\", isActive ? \"text-primary/70\" : \"text-white/30\")}>\n                                                    {room.last_message || \"Started a gossip...\"}\n                                                </p>\n                                                {/* Mocked unread badge if needed */}\n                                            </div>\n                                        </div>\n                                    </div>\n                                </Link>\n                            )\n                        })}\n                        {rooms.length === 0 && (\n                            <div className=\"flex flex-col items-center justify-center p-12 text-center\">\n                                <MessageSquare className=\"w-12 h-12 text-white/10 mb-4\" />\n                                <p className=\"text-xs text-white/30 font-bold uppercase tracking-widest italic\">No gossips yet</p>\n                            </div>\n                        )}\n                    </div>\n                </div>\n\n                {/* Footer User Info */}\n                <div className=\"p-4 border-t border-white/5 bg-black/80 backdrop-blur-md\">\n                    <div className=\"flex items-center gap-3\">\n                        <Avatar src={user?.user_metadata?.avatar_url} fallback={user?.email || \"?\"} className=\"w-10 h-10 ring-2 ring-white/10 shadow-lg\" />\n                        <div className=\"flex-1 overflow-hidden\">\n                            <p className=\"text-[13px] font-black truncate text-white uppercase tracking-tight\">{user?.user_metadata?.username || user?.email?.split('@')[0]}</p>\n                            <p className=\"text-[11px] font-bold text-primary flex items-center gap-1 uppercase tracking-widest\">\n                                Online\n                            </p>\n                        </div>\n                        <div className=\"flex gap-1\">\n                            <button onClick={() => setShowSettings(true)} className=\"text-white/40 hover:text-white transition-colors p-2 hover:bg-white/5 rounded-xl\">\n                                <Settings className=\"w-5 h-5\" />\n                            </button>\n                            <button onClick={handleLogout} className=\"text-white/40 hover:text-secondary transition-colors p-2 hover:bg-white/5 rounded-xl\">\n                                <LogOut className=\"w-5 h-5\" />\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            </aside>\n            {showSearch && <UserSearch onClose={() => setShowSearch(false)} currentUserId={user?.id} />}\n            {showRequests && <ConnectionRequests onClose={() => setShowRequests(false)} currentUserId={user?.id} />}\n            {showSettings && <SettingsModal onClose={() => setShowSettings(false)} user={user} />}\n        </>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1607, "column": 0}, "map": {"version":3,"sources":["file:///Users/apple/Desktop/GOSSIP/src/components/chat-shell.tsx"],"sourcesContent":["\"use client\";\n\nimport { usePathname, useSearchParams } from \"next/navigation\";\nimport { cn } from \"@/lib/utils\";\nimport { Sidebar } from \"@/components/sidebar\";\n\nexport function ChatShell({ children, user }: { children: React.ReactNode; user: any }) {\n    const pathname = usePathname();\n    const searchParams = useSearchParams();\n    const isRoomSelected = searchParams.has(\"roomId\");\n\n    return (\n        <div className=\"flex h-screen bg-background overflow-hidden relative\">\n            <div className={cn(\n                \"h-full transition-all duration-300\",\n                // Mobile: Full width if no room selected, hidden if room selected\n                // Desktop: Fixed width 80 (20rem) always\n                isRoomSelected ? \"hidden md:flex md:w-80\" : \"w-full md:w-80\"\n            )}>\n                <Sidebar user={user} />\n            </div>\n\n            {/* Main Chat Area */}\n            <main className={cn(\n                \"flex-1 relative flex flex-col h-full overflow-hidden transition-all duration-300\",\n                // Mobile: Hidden if no room selected, Full width if room selected\n                // Desktop: Always flex-1\n                !isRoomSelected ? \"hidden md:flex\" : \"flex w-full\"\n            )}>\n                {children}\n            </main>\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAJA;;;;;AAMO,SAAS,UAAU,EAAE,QAAQ,EAAE,IAAI,EAA4C;IAClF,MAAM,WAAW,IAAA,sKAAW;IAC5B,MAAM,eAAe,IAAA,0KAAe;IACpC,MAAM,iBAAiB,aAAa,GAAG,CAAC;IAExC,qBACI,mQAAC;QAAI,WAAU;;0BACX,mQAAC;gBAAI,WAAW,IAAA,8IAAE,EACd,sCACA,kEAAkE;gBAClE,yCAAyC;gBACzC,iBAAiB,2BAA2B;0BAE5C,cAAA,mQAAC,6JAAO;oBAAC,MAAM;;;;;;;;;;;0BAInB,mQAAC;gBAAK,WAAW,IAAA,8IAAE,EACf,oFACA,kEAAkE;gBAClE,yBAAyB;gBACzB,CAAC,iBAAiB,mBAAmB;0BAEpC;;;;;;;;;;;;AAIjB"}},
    {"offset": {"line": 1664, "column": 0}, "map": {"version":3,"sources":["file:///Users/apple/Desktop/GOSSIP/src/app/chat/layout.tsx"],"sourcesContent":["\"use client\";\n\nimport { useAuth } from \"@/contexts/auth-context\";\nimport { useRouter } from \"next/navigation\";\nimport { useEffect } from \"react\";\nimport { ChatShell } from \"@/components/chat-shell\";\n\nexport default function ChatLayout({\n    children,\n}: {\n    children: React.ReactNode;\n}) {\n    const { user, loading } = useAuth();\n    const router = useRouter();\n\n    useEffect(() => {\n        if (!loading && !user) {\n            router.push(\"/login\");\n        }\n    }, [user, loading, router]);\n\n    if (loading || !user) {\n        return (\n            <div className=\"flex items-center justify-center min-h-screen bg-black\">\n                <div className=\"animate-spin rounded-full h-8 w-8 border-t-2 border-primary\"></div>\n            </div>\n        );\n    }\n\n    return (\n        <ChatShell user={user as any}>\n            {children}\n        </ChatShell>\n    );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AALA;;;;;;AAOe,SAAS,WAAW,EAC/B,QAAQ,EAGX;IACG,MAAM,EAAE,IAAI,EAAE,OAAO,EAAE,GAAG,IAAA,mKAAO;IACjC,MAAM,SAAS,IAAA,oKAAS;IAExB,IAAA,uOAAS,EAAC;QACN,IAAI,CAAC,WAAW,CAAC,MAAM;YACnB,OAAO,IAAI,CAAC;QAChB;IACJ,GAAG;QAAC;QAAM;QAAS;KAAO;IAE1B,IAAI,WAAW,CAAC,MAAM;QAClB,qBACI,mQAAC;YAAI,WAAU;sBACX,cAAA,mQAAC;gBAAI,WAAU;;;;;;;;;;;IAG3B;IAEA,qBACI,mQAAC,qKAAS;QAAC,MAAM;kBACZ;;;;;;AAGb"}}]
}